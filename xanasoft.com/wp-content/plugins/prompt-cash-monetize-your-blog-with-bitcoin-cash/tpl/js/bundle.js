(()=>{"use strict";var t={752:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractModule=void 0,e.AbstractModule=class{constructor(t,e=null){this.plugin=t,this.webHelpers=e||this.plugin.getWebHelpers()}}},217:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Gateway=void 0,e.Gateway=class{constructor(t){this.lastPromptTxId="",this.config=t}generateRandomTxId(t){const e=this.getRandomString(4,!1),o=Math.floor(Date.now()/1e3);return this.lastPromptTxId=`${t}-${o}-${e}`,this.lastPromptTxId}getLastGeneratedTxId(){return this.lastPromptTxId}getPayFrameUrl(t,e,o,s="Post",i=""){const n=this.generateRandomTxId(t);o=o.toUpperCase();const r=encodeURI(0!==i.length?i:`Post ${t} @ ${this.config.siteUrl}`.trim());return this.config.frameUrl.replace("{promptTxId}",n).replace("{amount}",e.toFixed(8)).replace("{currency}",o).replace("{desc}",r)}getRandomString(t,e=!1){let o=e?"1234567890ABCDEF":"1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s="";for(let e=0;e<t;e++)s+=o.charAt(Math.floor(Math.random()*o.length));return s}}},107:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Payment=void 0;const s=o(752),i=o(863),n=o(217),r=o(949),a=o(185),l=o(524);class c extends s.AbstractModule{constructor(t){super(t),this.payments=new r.PaymentMap,this.paymentType="WP",this.currentPayID="",this.gateway=new n.Gateway(this.plugin.getConfig());const e=this.plugin.getConfig();this.addPayFrameListeners(),this.plugin.$(this.plugin.window.document).ready((t=>{void 0!==e.woocommerce&&!0===e.woocommerce.paymentPage?this.paymentType="WC":0!==this.plugin.$("h3.rcp_header").length&&(this.paymentType="RCP"),this.addButtonEvents()}))}addButtonEvents(){this.plugin.$(".ct-button-tip").on("click",(t=>{this.showPaymentFrame(t.target)})),this.plugin.$(".ct-input-amount").on("change",(t=>{this.updateEditableButtonAmount(t.target)})),this.plugin.$(".ct-input-amount").on("keyup",(t=>{this.updateEditableButtonAmount(t.target)}))}addPayFrameListeners(){const t=this.plugin.getConfig(),e=e=>{if(e.origin!==t.gatewayOrigin)return;let o=e.data;if("function"==typeof this[o.func])try{this[o.func].call(this,o.data)}catch(t){console.error("Error calling trusted event callback function: ",t)}};window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e,!1)}onPromptPaid(t){return new Promise(((e,o)=>{if(!t||"PAID"!==t.status)return void this.webHelpers.log(["received payment with invalid state",t.status]);const s=this.plugin.getConfig();this.scheduleRemovePayFrame();const i=t.tx_id;let n=this.payments.mergeWithExisting(i,t);const r=this.plugin.$(".ct-btn-wrap-"+this.currentPayID).find(".ct-button-tip");let l="WP"===this.paymentType?a.RestPaymentParams.fromButton(s,r,t):a.RestPaymentParams.fromWoocommerceOrder(s,t);this.webHelpers.getApi("wp-json/promptcash/v1/register-payment",l,(t=>{if(void 0!==t.data&&!0!==t.error){if(e(),"WC"===this.paymentType);else if("RCP"===this.paymentType);else if(!0===n.is_restricted)return void(!0===s.show_search_engines?(this.plugin.$("#ct-image-blurry-"+this.currentPayID).fadeOut("slow"),this.plugin.$("#ct-hidden-"+this.currentPayID).fadeIn("slow")):this.plugin.window.location.reload())}else o({text:"invalid payment response",res:t})}))}))}showPaymentFrame(t){this.plugin.$(".ct-button-frame").fadeOut("slow"),this.plugin.$(".ct-button-wrap").fadeIn("slow");const e=this.plugin.getConfig(),o=this.plugin.$(t),s=o.attr("data-id");this.currentPayID=s;const n=new l.PaymentButtonID(s),r=parseFloat(o.attr("data-amount")),a=o.attr("data-currency");this.plugin.$(".ct-btn-wrap-"+s).fadeOut("slow");const c=document.createElement("iframe"),p="WC"===this.paymentType?e.tr.order:e.tr.post;c.src=this.gateway.getPayFrameUrl(n.postID,r,a,p,e.title),c.scrolling="no",c.style.overflow="hidden",c.width="400px",c.height="800px";const u=this.plugin.$(".ct-button-frame-"+s);u.append(c),u.fadeIn("slow");const d=this.gateway.getLastGeneratedTxId();let h=new i.PaymentResponse;"1"===o.attr("data-restricted")&&(h.is_restricted=!0),this.payments.set(d,h)}updateEditableButtonAmount(t){this.plugin.getConfig();const e=this.plugin.$(t),o=parseFloat(e.val()),s=this.plugin.$(".ct-btn-wrap-"+this.currentPayID);s.find(".ct-button-tip").attr("data-amount",o),s.find(".ct-btn-display-amount").text(o)}scheduleRemovePayFrame(){const t=this.plugin.getConfig(),e="WC"===this.paymentType?5:0,o=".ct-button-frame-"+("WP"===this.paymentType?t.postID:t.woocommerce.orderID)+", .ct-button-frame-"+this.currentPayID;setTimeout((()=>{this.plugin.$(o).fadeOut("slow"),setTimeout((()=>{this.plugin.$(o).remove()}),1e3)}),1e3*e)}}e.Payment=c},886:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PromptCash=void 0;const s=o(853),i=o(143),n=o(107),r=o(576);class a{constructor(t,e){this.window=t,this.$=e,this.config=this.window.promptCashCfg||{},this.config.consentCookieName=a.CONSENT_COOKIE_NAME,this.config.confirmCookiesMsg=a.CONFIRM_COOKIES_MSG,this.config.confirmCookiesBtn=a.CONFIRM_COOKIES_BTN,this.webHelpers=new i.WebHelpers(this.window,this.$,this.config),this.tooltips=new s.Tooltips(this,this.webHelpers),this.adminControls=new r.AdminControls(this),this.payment=new n.Payment(this),this.$(this.window.document).ready((t=>{this.adminControls.init(),this.webHelpers.checkCookieConsent()}))}getConfig(){return this.config}getTooltips(){return this.tooltips}getWebHelpers(){return this.webHelpers}}e.PromptCash=a,a.CONSENT_COOKIE_NAME="prc-ck",a.CONFIRM_COOKIES_MSG="#ct-cookieMsg",a.CONFIRM_COOKIES_BTN="#ct-confirmCookies"},143:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WebHelpers=void 0,e.WebHelpers=class{constructor(t,e,o){this.cssSelectors=[],this.window=t,this.$=e,this.config=o}getBrowserLang(){return this.window.navigator.language.substr(0,2).toLowerCase()}getCookie(t){let e,o,s,i=this.window.document.cookie.split(";");for(e=0;e<i.length;e++)if(o=i[e].substr(0,i[e].indexOf("=")),s=i[e].substr(i[e].indexOf("=")+1),o=o.replace(/^\s+|\s+$/g,""),o==t)return decodeURI(s);return null}setCookie(t,e,o){let s=new Date;s=new Date(s.getTime()+864e5*(o||this.config.cookieLifeDays)),this.window.document.cookie=t+"="+e+"; expires="+s.toUTCString()+"; path="+this.config.cookiePath}removeCookie(t){this.window.document.cookie=t+"=; expires=Thu, 02 Jan 1970 00:00:00 UTC; path="+this.config.cookiePath}checkCookieConsent(){this.$(this.config.confirmCookiesBtn).click((()=>{this.confirmCookies()})),null!==this.getCookie(this.config.consentCookieName)&&this.$(this.config.confirmCookiesMsg).remove()}fromBase64(t){return"function"!=typeof this.window.atob?(this.window.console.error("Base64 decoding is not supported in your browser"),""):this.window.atob(t)}toBase64(t){return"function"!=typeof this.window.btoa?(this.window.console.error("Base64 encoding is not supported in your browser"),""):this.window.btoa(t)}translate(t,e,o=!1){if("string"!=typeof t)try{t=t.toString()}catch(e){return this.log("Text to translate is not a string"),t}let s=0,i=0;for(;-1!==(s=t.indexOf("{",s));){if(s>0&&"\\"===t.charAt(s-1)){s++;continue}if(i=t.indexOf("}",s),-1===i){this.log("Can not find end position while translating HTML");break}let n=t.substring(s+1,i),r=null;if("tr:"===n.substring(0,3)){let t=n.substring(3);r=this.tr(t)}else if("object"==typeof e){let t=e[n];void 0!==t&&(r="boolean"==typeof o&&o?t:this.escapeOutput(t))}if(null!==r){let e=new RegExp("\\{"+n+"\\}","g");t=t.replace(e,r)}else if(null!==n.match("^[A-Za-z0-9_]+$")){this.log("No translation found for place holder: "+n);let e=new RegExp("\\{"+n+"\\}","g");t=t.replace(e,"MISSING: "+this.escapeOutput(n))}else s+=n.length}return t.replace(/\\\\\\{/,"{")}escapeOutput(t,e=!0){return"string"!=typeof t||(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),void 0!==e&&!0!==e||(t=t.replace(/\r?\n/g,"<br>"))),t}escapeRegex(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}tr(t){return t}log(t){"object"==typeof this.window.console&&"function"==typeof this.window.console.log&&this.window.console.log(arguments)}isAppleIOS(){return/iPad|iPhone|iPod/.test(this.window.navigator.userAgent)&&!this.window.MSStream}getAllCssSelectors(t=!0){if(!0===t&&0!==this.cssSelectors.length)return this.cssSelectors;this.cssSelectors=[];try{const t=new RegExp("^"+this.escapeRegex(this.window.document.location.origin),"i");for(let e=0;e<this.window.document.styleSheets.length;e++){const o=this.window.document.styleSheets[e];if(!o.href||!1!==t.test(o.href)){if(o.rules)for(let t=0;t<o.rules.length;t++)o.rules[t].selectorText&&this.cssSelectors.push(o.rules[t].selectorText);if(o.imports)for(let t=0;t<o.imports.length;t++)for(let e=0;e<o.imports[t].rules.length;e++)o.imports[t].rules[e].selectorText&&this.cssSelectors.push(o.imports[t].rules[e].selectorText)}}}catch(t){this.window.console.error("Error getting CSS selectors",t)}return this.cssSelectors}isExistingCssSelector(t){const e=this.getAllCssSelectors();for(let o=0;o<e.length;o++)if(e[o]===t)return!0;return!1}confirmCookies(){this.$(this.config.confirmCookiesMsg).remove(),this.setCookie(this.config.consentCookieName,"1",this.config.cookieLifeDays)}getApi(t,e,o,s){"function"==typeof e?(o=e,e=null):void 0===e&&(e=null);let i=this.fixRelativeUrl(t);return this.$.get(i,e,((t,e,s)=>{o(t,e,s)}),s)}postApi(t,e,o,s){let i=this.fixRelativeUrl(t);return this.$.post(i,e,((t,e,s)=>{o(t,e,s)}),s)}fixRelativeUrl(t){if(0===t.toLowerCase().indexOf("http"))return t;let e=this.config.siteUrl;return 0!==t.length&&"/"===t[0]&&"/"===e[e.length-1]&&(e=e.substr(0,e.length-1)),e+=t,e}}},576:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AdminControls=void 0;const s=o(752);class i extends s.AbstractModule{constructor(t){super(t)}init(){-1!==this.plugin.$("body").attr("class").indexOf("promptcash")&&(this.plugin.getTooltips().initToolTips(),this.plugin.$(this.plugin.window.document).ready((t=>{})))}}e.AdminControls=i},853:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltips=void 0;const s=o(752);class i extends s.AbstractModule{constructor(t,e){super(t,e)}initToolTips(){const t=this.plugin.window,e=this.plugin.$,o=this,s=!1;let i=0,n=!1;const r=function(t,o=!1){o=o||!1;let s="pointerdown.tsfTT touchstart.tsfTT click.tsfTT",i=e(t);o?(i.off("mousemove mouseleave mouseout ct-tooltip-update"),e(document.body).off(s)):(i.on({mousemove:l,mouseleave:c,mouseout:c}),e(document.body).off(s).on(s,p)),i.on("ct-tooltip-update",a)},a=function(t){if(t.target.classList.contains("ct-tooltip-item")){let e=t.target.querySelector(".ct-tooltip-text");e instanceof Element&&(e.innerHTML=t.target.dataset.desc)}},l=function(t){let o=e(t.target),s=o.find(".ct-tooltip"),i=s.find(".ct-tooltip-arrow"),n=s.data("overflow"),r=s.data("overflowDir");if(n=parseInt(n,10),n=isNaN(n)?0:-Math.round(n),n)i.css(r,n+"px");else{let e=t.originalEvent&&t.originalEvent.pageX||t.pageX,n=7,r=16,a=o.closest(".ct-tooltip-wrap"),l=e-a.offset().left-r/2,c=s.find(".ct-tooltip-text-wrap"),p=c.outerWidth(!0),u=s.data("adjust"),d=s.data("adjustDir"),h=p-r-n;u=parseInt(u,10),u=isNaN(u)?0:Math.round(u),u&&(u="left"===d?-u:u,l+=u,h-u>a.outerWidth(!0))&&(h=c.find(".ct-tooltip-text").outerWidth(!0)-r-n),l<=n?i.css("left",n+"px"):l>=h?i.css("left",h+"px"):i.css("left",l+"px")}},c=function(t){var o;n||(e(t.target).find(".ct-tooltip").remove(),o=t.target,r(o,!0))},p=function(o){n=!0,clearTimeout(i),i=t.setTimeout((function(){n=!1}),250);let s,r=".ct-tooltip",a=e(o.target);if(a.hasClass("ct-tooltip-item")&&(s=a.find(r)),!s){let t=a.children(".ct-tooltip-item");t.length&&(s=t.find(r))}s&&s.length?e(r).not(s).remove():e(r).remove()},u=function(t){if(n)return;let o=!1;switch(t.type){case"mouseenter":break;case"pointerdown":case"touchstart":o=!0}if(t.target.classList.contains("ct-tooltip-item"))o&&p(t),function(t){let o=e(t.target),s=t.target.dataset.desc;if(s&&0===o.find("div").length){t.target.title="";let i=e('<div class="ct-tooltip"><span class="ct-tooltip-text-wrap"><span class="ct-tooltip-text">'+s+'</span></span><div class="ct-tooltip-arrow"></div></div>');o.append(i);let n=o.closest(".ct-tooltip-boundary");n=n.length&&n||e(document.body);let r=o.outerHeight()+9,a=i.offset().top-r;n.offset().top-(n.prop("scrolltop")||0)>a?(i.addClass("ct-tooltip-down"),i.css("top",r+"px")):i.css("bottom",r+"px");let l=o.closest(".ct-tooltip-wrap"),c=i.find(".ct-tooltip-text-wrap"),p=c.find(".ct-tooltip-text"),u=l.width(),d=c.outerWidth(!0),h=p.outerWidth(!0),g=c.offset().left,f=g+h,m=n.offset().left-(n.prop("scrollLeft")||0),w=m+n.outerWidth(),y="left";if(g<m){let t=m-g+12,e=parseInt(c.css("flex-basis"),10);t<-e&&(t=-e),i.css(y,t+"px"),i.data("overflow",t),i.data("overflowDir",y)}else if(f>w){let t=w-f-u-12,e=parseInt(c.css("flex-basis"),10);t<-e&&(t=-e),i.css(y,t+"px"),i.data("overflow",t),i.data("overflowDir",y)}else if(u<42){let t=-15;i.css(y,t+"px"),i.data("overflow",t),i.data("overflowDir",y)}else if(u>d){let e=(t.originalEvent&&t.originalEvent.pageX||t.pageX)-l.offset().left-d/2,o=e+d;e<0?e=0:o>u&&(e=u-h),i.css(y,e+"px"),i.data("adjust",e),i.data("adjustDir",y)}}}(t),l(t),r(t.target);else{let o=t.target.querySelector(".ct-tooltip-item:hover"),i=new e.Event(t.type);i.pageX=t.originalEvent&&t.originalEvent.pageX||t.pageX,o?(s&&console.log("Tooltip event warning: delegation"),e(o).trigger(i)):(s&&console.log("Tooltip event warning: bubbling"),e(t.target).closest(".ct-tooltip-wrap").find(".ct-tooltip-item:hover").trigger(i))}t.stopPropagation()},d=function(){let t=e(".ct-tooltip-wrap");t.off("mouseenter pointerdown touchstart"),t.on("mouseenter pointerdown touchstart",".ct-tooltip-item",u)};d(),e(t).on("ct-reset-tooltips",d),function(){let t=e("#wpcontent");o.addTooltipBoundary(t)}()}addTooltipBoundary(t){jQuery(t).addClass("ct-tooltip-boundary")}_triggerTooltipReset(){jQuery(window).trigger("ct-reset-tooltips")}_triggerTooltipUpdate(t){jQuery(t).trigger("ct-tooltip-update")}}e.Tooltips=i},524:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaymentButtonID=void 0,e.PaymentButtonID=class{constructor(t){this.postID=0,this.buttonNr=0;const e=t.split("-");if(2!==e.length)throw new Error("PaymentButtonID must have exactly 2 parts: postID-buttonNr");this.postID=parseInt(e[0]),this.buttonNr=parseInt(e[1])}getButtonIdStr(){return`${this.postID}-${this.buttonNr}`}}},949:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaymentMap=void 0;class o extends Map{constructor(){super()}mergeWithExisting(t,e){let o=this.get(t);return void 0!==o&&(e.is_restricted=o.is_restricted),this.set(t,e),e}}e.PaymentMap=o},863:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PaymentResponse=void 0;class o{constructor(){this.is_restricted=!1}static fromJson(t){return Object.assign(new o,t)}}e.PaymentResponse=o},185:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RestPaymentParams=void 0;class o{constructor(t,e,o,s){this.type="WP",this.amount=t,this.currency=e,this.postID=o,this.txID=s}static fromButton(t,e,s){return new o(parseFloat(e.attr("data-amount")),e.attr("data-currency"),e.attr("data-id"),s.tx_id)}static fromWoocommerceOrder(t,e){const s=t.woocommerce,i=`${s.orderID}`;let n=new o(s.amount,s.currency,i,e.tx_id);return n.type="WC",n}}e.RestPaymentParams=o}},e={};function o(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,o),n.exports}(()=>{let t=new(o(886).PromptCash)(window,jQuery);window.promptCashPlugin=t})()})();
//# sourceMappingURL=bundle.js.map