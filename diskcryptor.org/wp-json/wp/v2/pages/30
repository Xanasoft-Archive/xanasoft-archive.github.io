{"id":30,"date":"2020-02-01T09:28:33","date_gmt":"2020-02-01T09:28:33","guid":{"rendered":"https:\/\/www.diskcryptor.org\/?page_id=30"},"modified":"2021-03-18T08:40:40","modified_gmt":"2021-03-18T08:40:40","slug":"volume","status":"publish","type":"page","link":"https:\/\/diskcryptor.org\/volume\/","title":{"rendered":"Volume"},"content":{"rendered":"<h2>Encrypted partition format<\/h2>\n<p>Encrypted DiskCryptor partition does not have visible signatures or any other identifiable data. Without knowing the proper password it is indistinguishable from random numbers, and the structure of the partition can only be discovered by providing right password.<\/p>\n<p>Encrypted partition has the housekeeping data area (volume header) that is followed by the user data.<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/www.diskcryptor.org\/wp-content\/uploads\/sites\/3\/2021\/03\/DiskCryptor_Volume.png\" alt=\"DiskCryptor\" \/><\/p>\n<h3>Volume header<\/h3>\n<p>The first 2048 bytes of the partition are occupied by volume header. It contains the information about partition and keys to all user data. Volume header is encrypted with a chosen cryptographic algorithm in XTS mode, with a key derived from a user\\'s password. User data that has been residing in the first 2048 bytes of a partition is moved to a relocation area, which is a contiguous sequence of sectors in user area (please read details below). Volume header does not have visible signatures, and without knowing the correct password is indistinguishable from random numbers.<\/p>\n<h3>Volume header format<\/h3>\n<pre><code>typedef struct _dc_header {\n    u8  salt[PKCS5_SALT_SIZE]; \/* pkcs5.2 salt *\/\n    u32 sign;                  \/* signature &#039;DCRP&#039; *\/\n    u32 hdr_crc;               \/* crc32 of decrypted volume header *\/\n    u16 version;               \/* volume format version *\/\n    u32 flags;                 \/* volume flags *\/\n    u32 disk_id;               \/* unique volume identifier *\/\n    int alg_1;                 \/* crypt algo 1 *\/\n    u8  key_1[DISKKEY_SIZE];   \/* crypt key 1  *\/\n    int alg_2;                 \/* crypt algo 2 *\/\n    u8  key_2[DISKKEY_SIZE];   \/* crypt key 2  *\/\n\n    u64 stor_off;              \/* temporary storage offset *\/\n    u64 use_size;              \/* user available volume size *\/\n    u64 tmp_size;              \/* temporary part size *\/\n    u8  tmp_wp_mode;           \/* data wipe mode *\/\n\n    u8  reserved[1422 - 1];\n} dc_header;<\/code><\/pre>\n<table>\n<thead>\n<tr>\n<th>Offset<\/th>\n<th>Size<\/th>\n<th>Encryption<\/th>\n<th>Description<\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n<td>0<\/td>\n<td>64<\/td>\n<td>No<\/td>\n<td>Salt. Random number used when deriving volume header key.<\/td>\n<\/tr>\n<tr>\n<td>64<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>DiskCryptor volume signature. Has the value of 0x50524344 (ascii \\'DCRP\\').<\/td>\n<\/tr>\n<tr>\n<td>68<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>CRC32 of the remaining part of the header (bytes 72-2047).<\/td>\n<\/tr>\n<tr>\n<td>72<\/td>\n<td>2<\/td>\n<td>Yes<\/td>\n<td>Header format version. Has the value of 1 for DiskCryptor 0.5 volumes.<\/td>\n<\/tr>\n<tr>\n<td>74<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>Volume flags. Used for indicating volume\\'s state.<\/td>\n<\/tr>\n<tr>\n<td>78<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>Unique volume identifier. Used to search for a partition when choosing to boot from the specified partition.<\/td>\n<\/tr>\n<tr>\n<td>82<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>Identifier of a main cryptoalgorithm, with which partition is encrypted.<\/td>\n<\/tr>\n<tr>\n<td>86<\/td>\n<td>256<\/td>\n<td>Yes<\/td>\n<td>Main encryption key of user data on a volume.<\/td>\n<\/tr>\n<tr>\n<td>342<\/td>\n<td>4<\/td>\n<td>Yes<\/td>\n<td>Identifier of an additional cryptoalgorithm, with which partition is encrypted. Indicates about a previously used cryptoalgorithm on re-encryption.<\/td>\n<\/tr>\n<tr>\n<td>346<\/td>\n<td>256<\/td>\n<td>Yes<\/td>\n<td>Additional encryption key of user data on a volume. Used for storing the previous key on re-encryption.<\/td>\n<\/tr>\n<tr>\n<td>602<\/td>\n<td>8<\/td>\n<td>Yes<\/td>\n<td>Offset in user data area, by which the first 2048 bytes of partition data have been relocated.<\/td>\n<\/tr>\n<tr>\n<td>610<\/td>\n<td>8<\/td>\n<td>Yes<\/td>\n<td>Size of a user data area.<\/td>\n<\/tr>\n<tr>\n<td>618<\/td>\n<td>8<\/td>\n<td>Yes<\/td>\n<td>Size of the encrypted area. Present only in a partially encrypted state.<\/td>\n<\/tr>\n<tr>\n<td>626<\/td>\n<td>1<\/td>\n<td>Yes<\/td>\n<td>Partition wipe mode used on encryption. Present only in a partially encrypted state.<\/td>\n<\/tr>\n<tr>\n<td>627<\/td>\n<td>1421<\/td>\n<td>Yes<\/td>\n<td>Reserved. Zero-filled.<\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<h3>Relocation area<\/h3>\n<p>Relocation area - is a contiguous sequence of sectors where the first 2048 bytes of partition are stored.<\/p>\n<p>Currently there are two methods of placement of this area that are being used: in <code>$dcsys$<\/code> file, or at the end of partition. On encryption of partition that has data on it, this area is being placed in <code>$dcsys$<\/code>file, which is located in a contiguous sequence of clusters. On formatting a new partition, this area is being placed at the end of partition, after user data.<\/p>\n<p>In order to protect the <code>$dcsys$<\/code> file from being deleted, fragmented or moved, its access is forbidden by the driver.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Encrypted partition format Encrypted DiskCryptor partition does not have visible signatures or any other identifiable data. Without knowing the proper password it is indistinguishable from random numbers, and the structure of the partition can only be discovered by providing right password. Encrypted partition has the housekeeping data area (volume header) that is followed by the &hellip; <a href=\"https:\/\/diskcryptor.org\/volume\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">Volume<\/span> <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"parent":0,"menu_order":0,"comment_status":"closed","ping_status":"closed","template":"","meta":{"footnotes":""},"_links":{"self":[{"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/pages\/30"}],"collection":[{"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/comments?post=30"}],"version-history":[{"count":1,"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/pages\/30\/revisions"}],"predecessor-version":[{"id":164,"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/pages\/30\/revisions\/164"}],"wp:attachment":[{"href":"https:\/\/diskcryptor.org\/wp-json\/wp\/v2\/media?parent=30"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}