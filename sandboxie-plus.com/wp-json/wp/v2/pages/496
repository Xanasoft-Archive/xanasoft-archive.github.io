{"id":496,"date":"2020-10-12T17:38:17","date_gmt":"2020-10-12T15:38:17","guid":{"rendered":"https:\/\/xanasoft.com\/?page_id=496"},"modified":"2023-04-29T07:39:44","modified_gmt":"2023-04-29T07:39:44","slug":"sandboxhierarchy","status":"publish","type":"page","link":"https:\/\/sandboxie-plus.com\/sandboxie\/sandboxhierarchy\/","title":{"rendered":"Sandbox Hierarchy"},"content":{"rendered":"<h1>Sandbox Hierarchy<\/h1>\n<h3>Overview<\/h3>\n<p>When sandboxed programs create (or modify) objects, such as files, in fact, some kind of data should be created. Sandboxie creates these objects out of the way, to protect the system from harmful changes. But these objects must reside somewhere in the system. This page describes where various types of sandboxed objects are placed.<\/p>\n<p>Beginning with version 2.80 of Sandboxie, the layout of the sandbox is not tied to computer-specific device names and account names. See <a href=\"PortableSandbox\">Portable Sandbox<\/a> for more information.<\/p>\n<h3>Files<\/h3>\n<p>Files are created in the <em>Sandbox<\/em> folder according to the following hierarchy:<\/p>\n<pre><code>  . FileRootPath\n  . . drive\n  . . . C\n  . . . D\n  . . . Q\n  . . user\n  . . . all\n  . . . current<\/code><\/pre>\n<p>The <a href=\"FileRootPath\">FileRootPath<\/a> setting specifies a path to the root of a particular sandbox. In other words, if <a href=\"FileRootPath\">FileRootPath<\/a> specifies the folder <em>C:\\MySandbox<\/em>, then the sub-folders <em>drive<\/em> and <em>user<\/em> are created as <em>C:\\MySandbox\\drive<\/em> and <em>C:\\MySandbox\\user,<\/em> respectively.<\/p>\n<p>If the <a href=\"FileRootPath\">FileRootPath<\/a> setting is omitted, the <a href=\"BoxRootFolder\">BoxRootFolder<\/a> setting is used instead. The <a href=\"BoxRootFolder\">Box Root Folder<\/a> setting specifies a path to a group of sandboxes. In other words, if <a href=\"BoxRootFolder\">Box Root Folder<\/a> specifies the folder <em>C:\\MySandbox<\/em>, then the sub-folders <em>drive<\/em> and <em>user<\/em> are created as <em>C:\\MySandbox\\Sandbox\\DefaultBox\\drive<\/em> and <em>C:\\MySandbox\\Sandbox\\DefaultBox\\user,<\/em> respectively, and assuming the sandbox is called DefaultBox. Please note that <a href=\"BoxRootFolder\">BoxRootFolder<\/a> is a deprecated setting.<\/p>\n<p>As sandboxed programs create new files or modify existing files, Sandboxie redirects these operations to act on paths that lead into the sandbox. If the sandboxed program was trying to create the file <em>C:\\NEW.TXT<\/em>, it will be redirected to create instead <em>(<a href=\"FileRootPath\">FileRootPath<\/a>)\\drive\\C\\NEW.TXT<\/em>.<\/p>\n<p>If the sandboxed program was trying to create the file <em>C:\\Users\\joe\\Documents\\NEW.TXT<\/em>, it will be redirected to create <em>(<a href=\"FileRootPath\">FileRootPath<\/a>)\\user\\current\\Documents\\NEW.TXT<\/em>.<\/p>\n<p>Files that are created or modified in or below <em>profile<\/em> (or <em>home<\/em>) folders, such as <em>C:\\Users\\joe<\/em> (on Windows Vista and later) are redirected into the sandboxed <em>user\\current<\/em> folder.<\/p>\n<p>Files that are created or modified in or below the generic (or <em>All Users<\/em>) profile, are redirected into the sandboxed <em>user\\all<\/em> folder.<\/p>\n<p>Other files that don't match either of the above paths are redirected to the sandboxed <em>drive\\X<\/em> folder, where <em>X<\/em> would be the drive in which the files were <em>supposed<\/em> to have been written.<\/p>\n<p>Files that are created or modified on a remote network share are redirected into the sandboxed <em>share\\servername\\sharename<\/em> folder.<\/p>\n<p>When a program tries to open a file for which a copy already exists in the sandbox, Sandboxie will redirect the program to the copy of the file that was previously stored in the sandbox. On the other hand, if a copy for the file does not exist in the sandbox, and if the program does not try to modify the file, then Sandboxie will permit read-only access on the original file outside the sandbox. This behavior can be affected with the file-related settings <a href=\"OpenFilePath\">OpenFilePath<\/a>, <a href=\"ReadFilePath\">ReadFilePath<\/a>, and <a href=\"ClosedFilePath\">ClosedFilePath<\/a>.<\/p>\n<p>Note that the <em>Sandbox<\/em> folder itself resides on one particular drive, so even as sandboxed programs may create and modify files in multiple drives, all these files will end up residing <em>physically<\/em> in the same drive -- the drive where the <em>Sandbox<\/em> folder resides.<\/p>\n<p>Apart from the two sub-folders, <em>drive<\/em> and <em>user<\/em>, the <em>Sandbox<\/em> folder itself contains the file <em>RegHive<\/em>, and typically also <em>RegHive.LOG<\/em>. These hold the sandboxed registry. See below.<\/p>\n<h3>Registry<\/h3>\n<p>Registry keys are created in a sandboxed registry hive. A <em>registry hive<\/em> is the Microsoft Windows term for a group of related registry keys that are stored in a single <em>hive file<\/em>.<\/p>\n<p>Sandboxie creates the hive file in the <em>Sandbox<\/em> folder, as the files <em>RegHive<\/em> and <em>RegHive.LOG<\/em>. This hive is mounted (or in other words, loaded into the registry) when a sandboxed program starts. The hive is unmounted when all sandboxed programs end.<\/p>\n<p>The sandboxed hive has the following position and structure within the global structure of the Windows registry.<\/p>\n<pre><code> . HKEY_USERS\n . . KeyRootPath\n . . . machine\n . . . user\n . . . . current<\/code><\/pre>\n<p>The <a href=\"KeyRootPath\">KeyRootPath<\/a> setting specifies a path to the root of a particular sandbox. If omitted, it defaults to _HKEY<em>USERS\\Sandbox<\/em>(user name)<em>(sandbox name)<\/em>. For example, if the user joe is using the sandbox DefaultBox, the default <a href=\"KeyRootPath\">KeyRootPath<\/a> is _HKEY_USERS\\Sandbox_joe<em>DefaultBox<\/em>.<\/p>\n<p>As sandboxed programs create new registry keys or modify existing keys, Sandboxie redirects these operations to act on paths that lead into the sandbox. If the sandboxed program was trying to create the key _HKEY_LOCAL<em>MACHINE\\Software\\NewKey<\/em>, it will be redirected to create instead <em>(<a href=\"KeyRootPath\">KeyRootPath<\/a>)\\machine\\Software\\NewKey<\/em>.<\/p>\n<p>If the sandboxed program was trying to create the key _HKEY_CURRENT<em>USER\\Software\\NewKey<\/em>, it will be redirected to create <em>(<a href=\"KeyRootPath\">KeyRootPath<\/a>)\\user\\current\\Software\\NewKey<\/em>.<\/p>\n<p>With the sandboxed registry, the rules for redirection are simpler than for sandboxed files:<\/p>\n<ul>\n<li>\n<p>A registry key created or modified below the HKEY_LOCAL_MACHINE tree will be redirected below the sandboxed <em>machine<\/em> key.<\/p>\n<\/li>\n<li>\n<p>A registry key created or modified below the HKEY_CURRENT_USER tree will be redirected below the sandboxed <em>user\\current<\/em> key.<\/p>\n<\/li>\n<li>\n<p>A registry key created or modified below the HKEY_CLASSES_ROOT tree will be redirected below the sandboxed _user\\current<em>classes<\/em> key.<\/p>\n<\/li>\n<\/ul>\n<p>Note that the sandboxed <em>user\\current\\software\\classes<\/em> key is a symbolic link to the _user\\current<em>classes<\/em> key which means and the keys are effectively synonyms and share the same content in the sandboxed Windows registry.<\/p>\n<p>As with files, access to a key which has a copy in the sandboxed registry will be redirected to use the copy in the sandbox. Read-only access to a key which does not have a copy in the sandboxed registry will be permitted to access the key outside the sandbox. This behavior can be affected with the registry-related settings <a href=\"OpenKeyPath\">OpenKeyPath<\/a>, <a href=\"ReadKeyPath\">ReadKeyPath<\/a>, and <a href=\"ClosedKeyPath\">ClosedKeyPath<\/a>.<\/p>\n<h3>Inter-Process Objects<\/h3>\n<p>These objects are used by programs to share information, synchronize processing, and provide services. These objects are never written to disk and they disappear when the system shuts down.<\/p>\n<p>Sandboxie isolates these objects in order to make it possible to run the same program sandboxed and un-sandboxed side-by-side. It also keeps sandboxed programs from interfering with un-sandboxed ones.<\/p>\n<p>These objects are created in the NT object namespace. Their position and structure within that namespace are as follows.<\/p>\n<pre><code> . IpcRootPath\n . . BaseNamedObjects\n . . . Global\n . . . Local\n . . . Session\n . . RPC Control<\/code><\/pre>\n<p>The <a href=\"IpcRootPath\">IpcRootPath<\/a> setting specifies a path to the root of a particular sandbox. If omitted, it defaults to <em>\\Sandbox(user name)(sandbox name)\\Session<\/em>(session number)<em>. For example, if the user joe is running in session zero, and using the sandbox DefaultBox, the default <a href=\"IpcRootPath\">IpcRootPath<\/a> is <\/em>\\Sandbox\\joe\\DefaultBox\\Session<em>0<\/em>.<\/p>\n<p>Below the <a href=\"IpcRootPath\">IpcRootPath<\/a>, there are <em>object directories<\/em> which comprise the NT namespace, and match the layout of existing object directories outside the sandbox area. The directories are created with a <em>persistent<\/em> attribute, which means they will only disappear at system shutdown.<\/p>\n<p>Objects created by sandboxed programs are created within the sandbox object directories. If the program is running outside the supervision of Sandboxie, it would typically create such objects in the \\BaseNamedObjects object directory.<\/p>\n<p>Note that objects may be created without a name, in which case the object is effectively isolated to the particular program which created it. However, a program can access the internals of another program in order to locate and use such nameless objects. To mitigate this, Sandboxie prevents a program in the sandbox from accessing a program outside the sandbox in this way.<\/p>\n<p>The free utility <a href=\"https:\/\/docs.microsoft.com\/en-us\/sysinternals\/downloads\/winobj\">WinObj<\/a> by Sysinternals (now a part of Microsoft) can be used to display the NT object namespace.<\/p>\n<p>Unlike the case with files or registry keys, sandboxed programs are never permitted to access IPC objects outside the sandbox namespace, not even for read-only access. This behavior can be affected with the registry-related settings <a href=\"OpenIpcPath\">OpenIpcPath<\/a> and <a href=\"ClosedIpcPath\">ClosedIpcPath<\/a>.<\/p>\n<p>Note that Sandboxie includes a number of built-in <a href=\"OpenIpcPath\">OpenIpcPath<\/a> settings to allow programs to function correctly, and in a typical system, more <a href=\"OpenIpcPath\">OpenIpcPath<\/a> settings are applied through compatibility settings for third-party software.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Sandbox Hierarchy Overview When sandboxed programs create (or modify) objects, such as files, in fact, some kind of data should be created. Sandboxie creates these objects out of the way, to protect the system from harmful changes. But these objects must reside somewhere in the system. This page describes where various types of sandboxed objects &hellip; <a href=\"https:\/\/sandboxie-plus.com\/sandboxie\/sandboxhierarchy\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">Sandbox Hierarchy<\/span> <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":1,"featured_media":0,"parent":108,"menu_order":0,"comment_status":"closed","ping_status":"closed","template":"","meta":{"footnotes":""},"_links":{"self":[{"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/pages\/496"}],"collection":[{"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/pages"}],"about":[{"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/types\/page"}],"author":[{"embeddable":true,"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/comments?post=496"}],"version-history":[{"count":2,"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/pages\/496\/revisions"}],"predecessor-version":[{"id":2315,"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/pages\/496\/revisions\/2315"}],"up":[{"embeddable":true,"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/pages\/108"}],"wp:attachment":[{"href":"https:\/\/sandboxie-plus.com\/wp-json\/wp\/v2\/media?parent=496"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}